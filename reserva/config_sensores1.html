<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Configurar Sensores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      margin-top: 10px;
    }

    th,
    td {
      padding: 8px;
      border: 1px solid #ccc;
    }

    input,
    select {
      width: 100%;
      padding: 5px;
    }

    .actions button {
      margin-right: 5px;
    }
  </style>
</head>

<body>
  <h1>Cadastro de Sensores</h1>

  <table id="tabelaSensores">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Tipo</th>
        <th>Pino</th>
        <th>Zona</th>
        <th>Ativo</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button onclick="adicionarSensor()">Adicionar Sensor</button>
  <button onclick="salvarSensores()">Salvar</button>

  <script>
    let sensores = [];

    async function carregarSensores() {
      const resp = await fetch('/sensores.json');
      sensores = await resp.json();
      renderTabela();
    }

    function renderTabela() {
      const tbody = document.querySelector('#tabelaSensores tbody');
      tbody.innerHTML = '';
      sensores.forEach((s, i) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><input value="${s.nome}" onchange="sensores[${i}].nome = this.value"></td>
          <td>
            <select onchange="sensores[${i}].tipo = this.value">
              <option value="PIR" ${s.tipo === 'PIR' ? 'selected' : ''}>PIR</option>
              <option value="REED" ${s.tipo === 'REED' ? 'selected' : ''}>REED</option>
            </select>
          </td>
          <td>
             <select onchange="sensores[${i}].pino = this.value">
                ${['D0', 'D1', 'D2', 'D3', 'D4', 'D5', 'D6', 'D7', 'D8'].map(p =>
          `<option value="${p}" ${s.pino === p ? 'selected' : ''}>${p}</option>`).join('')}
              </select>
          </td>
          <td><input value="${s.zona}" onchange="sensores[${i}].zona = this.value"></td>
          <td><input type="checkbox" ${s.ativo ? 'checked' : ''} onchange="sensores[${i}].ativo = this.checked"></td>
          <td class="actions">
            <button onclick="removerSensor(${i})">Remover</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function adicionarSensor() {
      sensores.push({ nome: '', tipo: 'PIR', pino: 'D0', zona: '', ativo: true });
      renderTabela();
    }


    function removerSensor(index) {
      sensores.splice(index, 1);
      renderTabela();
    }

    async function salvarSensores() {
      const resp = await fetch('/sensores.json', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(sensores)
      });

      if (resp.ok) {
        alert('Sensores salvos com sucesso!');
      } else {
        alert('Erro ao salvar sensores!');
      }
    }

    carregarSensores();
  </script>
</body>

</html>